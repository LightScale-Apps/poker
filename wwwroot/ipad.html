<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            min-height: 100vh;
            min-height: -webkit-fill-available;
            background: radial-gradient(circle at center, #1a472a 0%, #0a2615 100%);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        html {
            height: -webkit-fill-available;
        }

        .table {
            background: radial-gradient(ellipse at center, #2a653f 0%, #1a472a 100%);
            box-shadow: 
                0 0 100px rgba(0,0,0,0.3),
                inset 0 0 60px rgba(0,0,0,0.3);
            width: 98vw;
            height: 85vh;
            border-radius: min(100px, 10vw);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 10px;
            position: relative;
            padding: 10px;
        }

        .playing-card {
            width: calc((98vw - 60px) / 5); /* Total width minus total gaps (4 * 15px) divided by 5 cards */
            height: calc(((98vw - 60px) / 5) * 1.4); /* Maintain 1.4 aspect ratio */
            position: relative;
            perspective: 1000px;
            margin: 0;
        }

        .playing-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: min(15px, 3vw);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .card-front {
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            transform: rotateY(0deg);
        }

        .card-back {
            background: linear-gradient(45deg, #1a4b2c 25%, #2d6a4f 25%, #2d6a4f 50%, #1a4b2c 50%, #1a4b2c 75%, #2d6a4f 75%);
            background-size: 20px 20px;
            border: min(8px, 2vw) solid white;
            position: absolute;
            top: 0;
            left: 0;
            transform: rotateY(180deg);
        }

        .next-button {
            position: fixed;
            bottom: min(40px, 10vh);
            padding: min(15px, 4vw) min(40px, 10vw);
            font-size: min(24px, 6vw);
            background: linear-gradient(145deg, #2d6a4f 0%, #1b4332 100%);
            color: white;
            border: none;
            border-radius: min(12px, 3vw);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 100;
            -webkit-tap-highlight-color: transparent;
        }

        .card-suit {
            font-size: min(15vw, 120px);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            line-height: 1;
        }

        .card-corner {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: min(8px, 2vw);
        }

        .card-corner.top-left {
            top: 0;
            left: 0;
        }

        .card-corner.bottom-right {
            bottom: 0;
            right: 0;
            transform: rotate(180deg);
        }

        .corner-value {
            font-size: min(4vw, 32px);
            font-weight: bold;
            line-height: 1;
        }

        .corner-suit {
            font-size: min(3.5vw, 28px);
            line-height: 1;
        }

        .community-cards {
            display: flex;
            gap: 15px;
            padding: 10px;
            justify-content: center;
            flex-wrap: nowrap;
            width: 98vw;
        }

        .red {
            color: #e53e3e;
        }

        .black {
            color: #2d3748;
        }

        @media (max-width: 768px) {
            .table {
                height: 70vh;
                border-radius: 30px;
            }

            .community-cards {
                gap: 10px;
            }

            .playing-card {
                width: calc((98vw - 40px) / 5); /* Adjusted for smaller gap on mobile */
                height: calc(((98vw - 40px) / 5) * 1.4);
            }
        }

        /* Fix for iOS Safari 100vh issue */
        @supports (-webkit-touch-callout: none) {
            body {
                min-height: -webkit-fill-available;
            }
        }

        #playerList {
            font-size: 24px;
            color: white;
        }
    </style>
</head>
<body>
    <h6 id="playerList"></h6>
    <div class="table">
        <div class="community-cards" id="communityCards"></div>
    </div>

    <button onclick="handleNextAction()" class="next-button">Next</button>



    <script>
        Game = new signalR.HubConnectionBuilder().withUrl("/game").build();


        function connectToServer(interval) {
            if (Game.state != 'Connected') {
                Game.start()
            } else {
                configureListeners();
                window.clearInterval(interval)
            }
        }

        function configureListeners() {
            Game.on("PlayerList", (player_list) => {
                document.getElementById("playerList").innerHTML = player_list
            })
        }

        let SR;
        SR = window.setInterval(() => {
            connectToServer(SR);
        }, 3000)

        const suits = {
            S: { symbol: "\u2660", color: "black", name: "spades" },
            H: { symbol: "\u2665", color: "red", name: "hearts" },
            D: { symbol: "\u2666", color: "red", name: "diamonds" },
            C: { symbol: "\u2663", color: "black", name: "clubs" },
        };

        const values = ["2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A"];
        let deck = [];
        let communityCards = [];
        let currentPhase = 0;

        function createDeck() {
            deck = [];
            for (v of values) {
                deck.push({ value: v, suit: "S" });
                deck.push({ value: v, suit: "H" });
                deck.push({ value: v, suit: "D" });
                deck.push({ value: v, suit: "C" });
            }
        }

        function createCard(value, suitString) {
            let suit = suits[suitString].symbol;

            const card = document.createElement("div");
            card.className = "playing-card";

            const inner = document.createElement("div");
            inner.className = "playing-card-inner";

            const front = document.createElement("div");
            front.className = `card-face card-front ${suits[suitString].color}`;

            const topLeftCorner = document.createElement("div");
            topLeftCorner.className = "card-corner top-left";
            topLeftCorner.innerHTML = `
                <div class="corner-value">${value}</div>
                <div class="corner-suit">${suit}</div>
            `;

            const bottomRightCorner = document.createElement("div");
            bottomRightCorner.className = "card-corner bottom-right";
            bottomRightCorner.innerHTML = `
                <div class="corner-value">${value}</div>
                <div class="corner-suit">${suit}</div>
            `;

            const centerSuit = document.createElement("div");
            centerSuit.className = "card-suit";
            centerSuit.textContent = suit;

            front.appendChild(topLeftCorner);
            front.appendChild(bottomRightCorner);
            front.appendChild(centerSuit);

            const back = document.createElement("div");
            back.className = "card-face card-back";

            inner.appendChild(front);
            inner.appendChild(back);
            card.appendChild(inner);

            return card;
        }

        function shuffle(iterations) {
            for (let _ = iterations; _ > 0; _--) {
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
            }
        }

        function handleNextAction() {
            if (currentPhase === 0) {
                createDeck();
                shuffle(7);
                communityCards = [];
                document.getElementById("communityCards").innerHTML = "";
                for (let i = 0; i < 3; i++) {
                    communityCards.push(deck.pop());
                }
                currentPhase = 1;
            } else if (currentPhase < 3) {
                communityCards.push(deck.pop());
                currentPhase++;
            } else {
                currentPhase = 0;
                communityCards = [];
                document.getElementById("communityCards").innerHTML = "";
                return;
            }

            const communityContainer = document.getElementById("communityCards");
            communityContainer.innerHTML = "";

            communityCards.forEach((card) => {
                const cardElement = createCard(card.value, card.suit);
                communityContainer.appendChild(cardElement);
            });
        }

        // Initialize the game
        handleNextAction();

        // Fix for iOS Safari 100vh issue
        function fixHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        window.addEventListener('resize', fixHeight);
        fixHeight();
    </script>
</body>
</html>